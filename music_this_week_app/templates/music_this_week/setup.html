<!DOCTYPE html>
<html>
<head>
    <title>
        Music This Week: Setup
    </title>
</head>
<body>
    <div class="wrapper" style="text-align: center;">
        <h1>Welcome, {{ display_name }}!</h1>
        <p>&nbsp;<strong><img src="{{ profile_photo }}" alt="User Profile Photo for {{ username }}" /></strong></p>
        <p><a href="{{ profile }}" target="_blank">{{ username }}</a>&nbsp; &nbsp;&nbsp;<a href="/login/?retry=true">Switch Users</a></p>
        <p><span style="text-decoration: underline;">Search Arguments:</span></p>
        <form action="/search" id="form">
            <p><strong>Location:</strong> <input id = "loc_field" type="text" name="location" value="{{location}}"> <input type = "checkbox" onchange = "checkBox.call(this)"> Use my current location </p>
            <p><strong>Time range:</strong> <input id = "date_field" type="text" name="date" value="Next 7 Days"></p>
            <p><input id = "hidden_lat" hidden = true name = "hidden_lat"></p>
            <p><input id = "hidden_lon" hidden = true name = "hidden_lon"></p>
            <input hidden=true name="nResults" value="200">
            <button type="submit" id="search-button" onclick="buttonClick(this.form)">Search</button>
        </form>
        <p>&nbsp;</p>
        <p id="wait-text" hidden="True">Please be patient. In few minutes a playlist called musicThisWeek will appear in your spotify app.<br><br>If you close this page, the playlist will still be created in the background.</p>
    </div>
    <script>
        //init a variable that will contain user lat lng if checkbox clicked
        var userLocation = null;
        //When Search button is pressed, change the UI and then submit the request.
        function buttonClick(form) {
            document.getElementById('search-button').innerHTML = "Searching...";
            document.getElementById('search-button').disabled = "True";
            document.getElementById('wait-text').hidden = false;
            form.submit();
        }
        function checkBox(){
        console.log("box checked");
        console.log(userLocation);
        if (userLocation === null){
            getUserLocation();
            }
        var loc_field = document.getElementById('loc_field');
        if (loc_field.hidden){
            loc_field.hidden = false;
            }
        else{
            loc_field.hidden = true;
            }
        }
       
        function getUserLocation(){
            console.log("getting user location");
            navigator.geolocation.getCurrentPosition(
                locationProvided, locationError);


        }

        function locationProvided(position) {
            var lat = position.coords.latitude.toString();
            var lon = position.coords.longitude.toString();
            document.getElementById('hidden_lat').value = lat;
            document.getElementById('hidden_lon').value = lon;
            
	}
 
        function locationError(error){
            console.log("error");
        }


    </script>
</body>
</html>
